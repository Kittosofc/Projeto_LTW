<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home ADM</title>
  <link rel="stylesheet" href="CSS/main.css" />
  <link rel="stylesheet" href="CSS/home_adm.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body data-theme="light">
  <script src="JS/script.js"></script>
  <aside class="sidebar">
    <div class="user-info">
      <img src="IMG/me.jpg" id="user-avatar" class="avatar" alt="User Icon">
      <span class="username" id="user-name">Carregando...</span>
       <span id="user-position"></span>
    </div>
    <nav>
    <ul class="main-menu">
    <li class="has-submenu">
        <a href="home_adm.html" class="active">
            <svg class ="menu-icon" width="16" height="18" viewBox="0 0 16 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 18C1.45 18 0.979333 17.8043 0.588 17.413C0.196 17.021 0 16.55 0 16V7C0 6.68333 0.0709998 6.38333 0.213 6.1C0.354333 5.81667 0.55 5.58333 0.8 5.4L6.8 0.9C6.98333 0.766667 7.175 0.666667 7.375 0.6C7.575 0.533333 7.78333 0.5 8 0.5C8.21667 0.5 8.425 0.533333 8.625 0.6C8.825 0.666667 9.01667 0.766667 9.2 0.9L15.2 5.4C15.45 5.58333 15.646 5.81667 15.788 6.1C15.9293 6.38333 16 6.68333 16 7V16C16 16.55 15.8043 17.021 15.413 17.413C15.021 17.8043 14.55 18 14 18H10V11H6V18H2Z"/>
            </svg>
            <span>Geral</span>
        </a>

    </li>
    <li class="has-submenu">
        <a href="#">
            <img src="IMG/user.png" alt="User Icon">
            <span>Utilizadores</span>
        </a>
        <ul class="sub-menu">
            <li>
              <a href="home_adm_funcionarios.html" style="text-decoration: none; color: inherit;">

               FuncionÃ¡rios
              </a>
            </li>

            <li>
              <a href="home_adm_client.html" style="text-decoration: none; color: inherit;">
                Clientes
              </a>
                
            </li>
        </ul>
    </li>
    <li class="has-submenu">
        <a href="home_adm_permisoes.html">
            <img src="IMG/permissions.png" alt="Permission icon">
            <span>PermissÃµes</span>
        </a>
    </li>
    <li>
  <a href="#" id="logout-link">

    <svg width="18" height="18" viewBox="0 0 18 18" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
      <path d="M2 18C1.45 18 0.979 17.8043 0.587 17.413C0.195667 17.021 0 16.55 0 16V2C0 1.45 0.195667 0.979 0.587 0.587C0.979 0.195667 1.45 0 2 0H9V2H2V16H9V18H2ZM13 14L11.625 12.55L14.175 10H6V8H14.175L11.625 5.45L13 4L18 9L13 14Z"/>
    </svg>          
    <span>Sair</span>
  </a>
    </li>
  </ul>
      <div class="sidebar-footer">
        <button id="theme-toggle" aria-label="Alternar tema">ðŸŒ™</button>
      </div>
    </nav>
  </aside>

  <main class="main">
    <header class="header">
      <div class="location-wrapper">
        <img src="IMG/location-icon.png" alt="LocalizaÃ§Ã£o" class="icon-location">
        <select>
          <option selected>Medianeira, PR</option>
          <option>SÃ£o Paulo, SP</option>
          <option>Rio de Janeiro, RJ</option>
          <option>Outros...</option>
        </select>
      </div>
      </div>
      <div class="search-bar">
        <input type="text" placeholder="Pesquisar...">
        <img src="IMG/search-icon.png" alt="Pesquisar" class="icon-search">
      </div>
    </header>
    <section class="pie-chart-container">
  <svg width="250" height="250" viewBox="0 0 42 42" class="pie-chart" aria-label="DistribuciÃ³n de roles">
    <!-- Fondo gris -->
    <circle class="pie-chart__background" cx="21" cy="21" r="15.9155" />
    
    <!-- Segmentos (stroke-dasharray: porcentaje + espacio para completar el cÃ­rculo) -->
    <!-- Los valores son porcentajes, para total 100% = 2Ï€r â‰ˆ 100 -->
    
    <!-- Gerentes 30% -->
    <circle class="pie-chart__segment segment-gerente"
            cx="21" cy="21" r="15.9155"
            stroke-dasharray="30 70"
            stroke-dashoffset="0" />
    <!-- Operadores 25% -->
    <circle class="pie-chart__segment segment-operador"
            cx="21" cy="21" r="15.9155"
            stroke-dasharray="25 75"
            stroke-dashoffset="-30" />
    <!-- Administradores 20% -->
    <circle class="pie-chart__segment segment-admin"
            cx="21" cy="21" r="15.9155"
            stroke-dasharray="20 80"
            stroke-dashoffset="-55" />
    <!-- Clientes 25% -->
    <circle class="pie-chart__segment segment-clientes"
            cx="21" cy="21" r="15.9155"
            stroke-dasharray="25 75"
            stroke-dashoffset="-75" />
  </svg>
  
  <div class="pie-legend">
    <div><span class="legend-color gerente"></span> Gerentes (30%)</div>
    <div><span class="legend-color operador"></span> Operadores (25%)</div>
    <div><span class="legend-color clientes"></span> Clientes (25%)</div>
    <div><span class="legend-color admin"></span> Administradores (20%)</div>
    
  </div>
</section>
  </main>

<script>
// Quando a pÃ¡gina carregar, buscar dados do utilizador
fetch('/api/usuario-adm')
  .then(res => {
    if (!res.ok) throw new Error('NÃ£o autenticado');
    return res.json();
  })
  .then(data => {
    document.getElementById('user-name').textContent = data.nome;
    document.getElementById('user-avatar').src = 'IMG/' + data.foto;
    document.getElementById('user-position').textContent = data.rol;
  })
  .catch(err => {
    alert('VocÃª nÃ£o estÃ¡ autenticado. Por favor, faÃ§a login.');
    window.location.href = '/login_adm.html';
  });

// Logout
document.getElementById('logout-link').addEventListener('click', function (e) {
  e.preventDefault();
  fetch('/logout')
    .then(() => {
      window.location.href = '/login_adm.html';
    })
    .catch(() => {
      alert('Erro ao sair. Tente novamente.');
    });
});

fetch('/api/contagem-cargos')
  .then(res => res.json())
  .then(data => {
    const total = data.reduce((sum, item) => sum + item.total, 0);
    let offset = 0;
    const svg = document.querySelector('.pie-chart');
    const legend = document.querySelector('.pie-legend');

    // Limpa o grÃ¡fico e adiciona o fundo
    svg.innerHTML = '<circle class="pie-chart__background" cx="21" cy="21" r="15.9155" />';

    // Limpa a legenda
    legend.innerHTML = '';

    data.forEach((item, index) => {
      const percent = ((item.total / total) * 100).toFixed(2);
      const dashArray = `${percent} ${100 - percent}`;

      const segment = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      segment.setAttribute('class', 'pie-chart__segment');
      segment.setAttribute('cx', '21');
      segment.setAttribute('cy', '21');
      segment.setAttribute('r', '15.9155');
      segment.setAttribute('stroke-dasharray', dashArray);
      segment.setAttribute('stroke-dashoffset', offset);
      segment.style.stroke = getColor(index);

      svg.appendChild(segment);

      const legendItem = document.createElement('div');
      legendItem.innerHTML = `<span class="legend-color" style="background:${getColor(index)}"></span> ${item.cargo} (${percent}%)`;
      legend.appendChild(legendItem);

      offset -= percent;
    });
  });

function getColor(i) {
  const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#34495e'];
  return colors[i % colors.length];
}


</script>

</body>
</html>


